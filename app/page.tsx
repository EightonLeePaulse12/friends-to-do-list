'use client';

import React, { useEffect, useState } from 'react'
import axios from 'axios'
import Swal from 'sweetalert2'
import Link from 'next/link';


interface Todo {
  id: number;
  name: string;
  dueDate: string;
  isCompleted: boolean;
  priority: "One" | "Two" | "Three" | "Four" | "Five";
}

const page: React.FC = () => {

  const [todos, setToDo] = useState<Todo[]>([]);

  useEffect(() => {
    try {
      const fetchData = async () => {
        const res = await axios.get("/api/getToDos")
        const list = res.data.todos
        console.log(res.data)
        setToDo(list)
        console.log("type: ", list)
      }

      fetchData()
    } catch (error) {
      console.log(error)
    }
  }, [])

  const handleDel = async (id: Number) => {
    const res = await Swal.fire({
      title: "Are you sure?",
      text: "You will not be able to recover this",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: "#d33",
      confirmButtonText: "Yes, delete it!"
    })

    if (res.isConfirmed) {
      try {
        const resp = await axios.delete('/api/deleteToDo', {
          data: { id: id }
        })
        await Swal.fire({
          title: "deleted",
          text: "This item has been deleted successfully",
          icon: "success"
        })
        console.log(resp)
        // location.reload()
      } catch (error) {
        console.log(error)
        Swal.fire({
          title: "An error has occured",
          text: "An error occured while deleting the data",
          icon: "error"
        })
      }
    } else {
      Swal.fire({
        title: 'Error!',
        text: 'An error occurred while deleting the data.',
        icon: 'error',
      });
    }
  }

  return (
    <>
      <div className="add-btn w-full h-12 flex justify-center items-center p-2">
        <Link href="/add">
          <button type="button" className="flex">Add Item <span><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 12.998H13V18.998H11V12.998H5V10.998H11V4.99805H13V10.998H19V12.998Z" fill="#699BF7" />
          </svg></span></button>
        </Link>
      </div>
      <div className="w-full h-screen flex justify-center items-center">
        <table className="text-left">
          <thead>
            <tr>
              <th className="p-3">Name</th>
              <th className="p-3">Due Date</th>
              <th className="p-3">Priority</th>
              <th className="p-3">Completed</th>
              <th className="p-3">Edit</th>
              <th className="p-3">Delete</th>
            </tr>
          </thead>
          <tbody>
            {todos.map((todo) => (
              <tr key={todo.id}>
                <td className="p-3">{todo.name}</td>
                <td className="p-3">{todo.dueDate.substring(0, 10)}</td>
                <td className="p-3 flex justify-center">{todo.priority === "One" ? (<svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.25 12.5C5.38542 12.5 4.57292 12.3358 3.8125 12.0075C3.05208 11.6792 2.39062 11.234 1.82812 10.6719C1.26563 10.1094 0.820417 9.44792 0.4925 8.6875C0.164583 7.92708 0.000416667 7.11458 0 6.25C0 5.38542 0.164167 4.57292 0.4925 3.8125C0.820833 3.05208 1.26604 2.39062 1.82812 1.82812C2.39062 1.26563 3.05208 0.820417 3.8125 0.4925C4.57292 0.164583 5.38542 0.000416667 6.25 0C7.11458 0 7.92708 0.164167 8.6875 0.4925C9.44792 0.820833 10.1094 1.26604 10.6719 1.82812C11.2344 2.39062 11.6798 3.05208 12.0081 3.8125C12.3365 4.57292 12.5004 5.38542 12.5 6.25C12.5 7.11458 12.3358 7.92708 12.0075 8.6875C11.6792 9.44792 11.234 10.1094 10.6719 10.6719C10.1094 11.2344 9.44792 11.6798 8.6875 12.0081C7.92708 12.3365 7.11458 12.5004 6.25 12.5Z" fill="#006B4E" />
                </svg>
                ) : todo.priority === "Two" ? (<svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.25 12.5C5.38542 12.5 4.57292 12.3358 3.8125 12.0075C3.05208 11.6792 2.39062 11.234 1.82812 10.6719C1.26563 10.1094 0.820417 9.44792 0.4925 8.6875C0.164583 7.92708 0.000416667 7.11458 0 6.25C0 5.38542 0.164167 4.57292 0.4925 3.8125C0.820833 3.05208 1.26604 2.39062 1.82812 1.82812C2.39062 1.26563 3.05208 0.820417 3.8125 0.4925C4.57292 0.164583 5.38542 0.000416667 6.25 0C7.11458 0 7.92708 0.164167 8.6875 0.4925C9.44792 0.820833 10.1094 1.26604 10.6719 1.82812C11.2344 2.39062 11.6798 3.05208 12.0081 3.8125C12.3365 4.57292 12.5004 5.38542 12.5 6.25C12.5 7.11458 12.3358 7.92708 12.0075 8.6875C11.6792 9.44792 11.234 10.1094 10.6719 10.6719C10.1094 11.2344 9.44792 11.6798 8.6875 12.0081C7.92708 12.3365 7.11458 12.5004 6.25 12.5Z" fill="#4ECB71" />
                </svg>
                ) : todo.priority === "Three" ? (
                  <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6.25 12.5C5.38542 12.5 4.57292 12.3358 3.8125 12.0075C3.05208 11.6792 2.39062 11.234 1.82812 10.6719C1.26563 10.1094 0.820417 9.44792 0.4925 8.6875C0.164583 7.92708 0.000416667 7.11458 0 6.25C0 5.38542 0.164167 4.57292 0.4925 3.8125C0.820833 3.05208 1.26604 2.39062 1.82812 1.82812C2.39062 1.26563 3.05208 0.820417 3.8125 0.4925C4.57292 0.164583 5.38542 0.000416667 6.25 0C7.11458 0 7.92708 0.164167 8.6875 0.4925C9.44792 0.820833 10.1094 1.26604 10.6719 1.82812C11.2344 2.39062 11.6798 3.05208 12.0081 3.8125C12.3365 4.57292 12.5004 5.38542 12.5 6.25C12.5 7.11458 12.3358 7.92708 12.0075 8.6875C11.6792 9.44792 11.234 10.1094 10.6719 10.6719C10.1094 11.2344 9.44792 11.6798 8.6875 12.0081C7.92708 12.3365 7.11458 12.5004 6.25 12.5Z" fill="#FFC700" />
                  </svg>
                ) : todo.priority === "Four" ? (<svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.25 12.5C5.38542 12.5 4.57292 12.3358 3.8125 12.0075C3.05208 11.6792 2.39062 11.234 1.82812 10.6719C1.26563 10.1094 0.820417 9.44792 0.4925 8.6875C0.164583 7.92708 0.000416667 7.11458 0 6.25C0 5.38542 0.164167 4.57292 0.4925 3.8125C0.820833 3.05208 1.26604 2.39062 1.82812 1.82812C2.39062 1.26563 3.05208 0.820417 3.8125 0.4925C4.57292 0.164583 5.38542 0.000416667 6.25 0C7.11458 0 7.92708 0.164167 8.6875 0.4925C9.44792 0.820833 10.1094 1.26604 10.6719 1.82812C11.2344 2.39062 11.6798 3.05208 12.0081 3.8125C12.3365 4.57292 12.5004 5.38542 12.5 6.25C12.5 7.11458 12.3358 7.92708 12.0075 8.6875C11.6792 9.44792 11.234 10.1094 10.6719 10.6719C10.1094 11.2344 9.44792 11.6798 8.6875 12.0081C7.92708 12.3365 7.11458 12.5004 6.25 12.5Z" fill="#F24E1E" />
                </svg>
                ) : todo.priority === "Five" ? (
                  <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6.25 12.5C5.38542 12.5 4.57292 12.3358 3.8125 12.0075C3.05208 11.6792 2.39062 11.234 1.82812 10.6719C1.26563 10.1094 0.820417 9.44792 0.4925 8.6875C0.164583 7.92708 0.000416667 7.11458 0 6.25C0 5.38542 0.164167 4.57292 0.4925 3.8125C0.820833 3.05208 1.26604 2.39062 1.82812 1.82812C2.39062 1.26563 3.05208 0.820417 3.8125 0.4925C4.57292 0.164583 5.38542 0.000416667 6.25 0C7.11458 0 7.92708 0.164167 8.6875 0.4925C9.44792 0.820833 10.1094 1.26604 10.6719 1.82812C11.2344 2.39062 11.6798 3.05208 12.0081 3.8125C12.3365 4.57292 12.5004 5.38542 12.5 6.25C12.5 7.11458 12.3358 7.92708 12.0075 8.6875C11.6792 9.44792 11.234 10.1094 10.6719 10.6719C10.1094 11.2344 9.44792 11.6798 8.6875 12.0081C7.92708 12.3365 7.11458 12.5004 6.25 12.5Z" fill="#B10000" />
                  </svg>
                ) : null}</td>
                <td className="p-3 ">{todo.isCompleted ? (
                  <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12.5 1.31432L3.92857 12.5L0 7.37323L1.00714 6.05891L3.92857 9.86204L11.4929 0L12.5 1.31432Z" fill="#4ECB71" />
                  </svg>

                ) : (
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M13.0672 12.1829C13.1252 12.241 13.1713 12.3099 13.2027 12.3858C13.2342 12.4617 13.2503 12.543 13.2503 12.6251C13.2503 12.7072 13.2342 12.7885 13.2027 12.8644C13.1713 12.9403 13.1252 13.0092 13.0672 13.0673C13.0091 13.1254 12.9402 13.1714 12.8643 13.2028C12.7884 13.2343 12.7071 13.2505 12.625 13.2505C12.5429 13.2505 12.4615 13.2343 12.3857 13.2028C12.3098 13.1714 12.2409 13.1254 12.1828 13.0673L6.99998 7.8837L1.81717 13.0673C1.69989 13.1846 1.54083 13.2505 1.37498 13.2505C1.20913 13.2505 1.05007 13.1846 0.932794 13.0673C0.815518 12.95 0.749634 12.791 0.749634 12.6251C0.749634 12.4593 0.815518 12.3002 0.932794 12.1829L6.11639 7.0001L0.932794 1.81729C0.815518 1.70002 0.749634 1.54096 0.749634 1.3751C0.749634 1.20925 0.815518 1.05019 0.932794 0.932916C1.05007 0.81564 1.20913 0.749756 1.37498 0.749756C1.54083 0.749756 1.69989 0.81564 1.81717 0.932916L6.99998 6.11651L12.1828 0.932916C12.3001 0.81564 12.4591 0.749756 12.625 0.749756C12.7908 0.749756 12.9499 0.81564 13.0672 0.932916C13.1844 1.05019 13.2503 1.20925 13.2503 1.3751C13.2503 1.54096 13.1844 1.70002 13.0672 1.81729L7.88357 7.0001L13.0672 12.1829Z" fill="#B10000" />
                  </svg>
                )}</td>
                <td className="p-3">
                  <button type="button" className="">
                    <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9.30372 1.72004L8.72437 2.2994L3.39893 7.62421C3.03832 7.98544 2.8577 8.16606 2.70271 8.36481C2.51966 8.59934 2.3627 8.85312 2.2346 9.12165C2.12648 9.34915 2.04586 9.59164 1.88461 10.0754L1.20089 12.1259L1.03339 12.6272C0.994217 12.744 0.988404 12.8694 1.01661 12.9894C1.04482 13.1094 1.10592 13.2191 1.19306 13.3062C1.2802 13.3933 1.38991 13.4545 1.50987 13.4827C1.62983 13.5109 1.75528 13.5051 1.87211 13.4659L2.37335 13.2984L4.4239 12.6147C4.90826 12.4534 5.15012 12.3728 5.37761 12.2647C5.64635 12.1365 5.90009 11.9797 6.13446 11.7966C6.3332 11.6416 6.51382 11.4609 6.87443 11.1003L12.1999 5.7749L12.7792 5.19554C13.2401 4.73466 13.499 4.10958 13.499 3.45779C13.499 2.80601 13.2401 2.18092 12.7792 1.72004C12.3183 1.25916 11.6933 1.00024 11.0415 1.00024C10.3897 1.00024 9.7646 1.25916 9.30372 1.72004Z" stroke="#699BF7" stroke-width="1.5" />
                      <path opacity="0.5" d="M8.72441 2.29883C8.72441 2.29883 8.79691 3.53003 9.88312 4.61624C10.9693 5.70246 12.1999 5.77433 12.1999 5.77433M2.37339 13.2984L1.20093 12.126" stroke="#699BF7" stroke-width="1.5" />
                    </svg>

                  </button>
                </td>
                <td className="p-3 flex justify-center items-center">
                  <button className="" onClick={() => handleDel(todo.id)}>
                    <svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path opacity="0.5" d="M2.34375 15C1.91406 15 1.54635 14.8369 1.24062 14.5108C0.934896 14.1847 0.781771 13.7922 0.78125 13.3333V2.5H0V0.833333H3.90625V0H8.59375V0.833333H12.5V2.5H11.7188V13.3333C11.7188 13.7917 11.5659 14.1842 11.2602 14.5108C10.9544 14.8375 10.5865 15.0006 10.1562 15H2.34375ZM10.1562 2.5H2.34375V13.3333H10.1562V2.5ZM3.90625 11.6667H5.46875V4.16667H3.90625V11.6667ZM7.03125 11.6667H8.59375V4.16667H7.03125V11.6667Z" fill="#B10000" />
                    </svg>

                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </>
  )
}

export default page